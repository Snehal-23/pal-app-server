{"ast":null,"code":"var express = require(\"express\");\n\nvar router = express.Router();\n\nvar productController = require(\"../controllers/product\");\n\nvar multer = require(\"multer\");\n\nvar FILE_TYPE_MAP = {\n  \"image/png\": \"png\",\n  \"image/jpeg\": \"jpeg\",\n  \"image/jpg\": \"jpg\"\n};\nvar storage = multer.diskStorage({\n  destination: function destination(req, file, cb) {\n    var isValid = FILE_TYPE_MAP[file.mimetype];\n    var uploadError = new Error(\"invalid image type\");\n\n    if (isValid) {\n      uploadError = null;\n    }\n\n    cb(uploadError, \"public/uploads\");\n  },\n  filename: function filename(req, file, cb) {\n    var fileName = file.originalname.split(\" \").join(\"-\");\n    var extension = FILE_TYPE_MAP[file.mimetype];\n    cb(null, fileName + \"-\" + Date.now() + \".\" + extension);\n  }\n});\nvar uploadOptions = multer({\n  storage: storage\n});\nrouter.get(\"/\", productController.getProducts);\nrouter.get(\"/sale/:limit\", productController.getProductOnSale);\nrouter.post(\"/count\", productController.countProduct);\nrouter.get(\"/:id\", productController.getProduct);\nrouter.post(\"/\", uploadOptions.single(\"image\"), productController.postProduct);\nrouter.post(\"/upload/imageGallery\", uploadOptions.array(\"images\", 10), productController.uploadImageGallery);\nrouter.post(\"/update/:id\", productController.updateProduct);\nrouter.post(\"/delete/:id\", productController.deleteProduct);\nmodule.exports = router;","map":{"version":3,"names":["express","require","router","Router","productController","multer","FILE_TYPE_MAP","storage","diskStorage","destination","req","file","cb","isValid","mimetype","uploadError","Error","filename","fileName","originalname","split","join","extension","Date","now","uploadOptions","get","getProducts","getProductOnSale","post","countProduct","getProduct","single","postProduct","array","uploadImageGallery","updateProduct","deleteProduct","module","exports"],"sources":["C:/Users/snehal/eduvanz/pal/routes/products.js"],"sourcesContent":["const express = require(\"express\");\r\n\r\nconst router = express.Router();\r\n\r\nconst productController = require(\"../controllers/product\");\r\n\r\nconst multer = require(\"multer\");\r\n\r\nconst FILE_TYPE_MAP = {\r\n  \"image/png\": \"png\",\r\n  \"image/jpeg\": \"jpeg\",\r\n  \"image/jpg\": \"jpg\",\r\n};\r\n\r\nconst storage = multer.diskStorage({\r\n  destination: function (req, file, cb) {\r\n    const isValid = FILE_TYPE_MAP[file.mimetype];\r\n    let uploadError = new Error(\"invalid image type\");\r\n\r\n    if (isValid) {\r\n      uploadError = null;\r\n    }\r\n    cb(uploadError, \"public/uploads\");\r\n  },\r\n  filename: function (req, file, cb) {\r\n    const fileName = file.originalname.split(\" \").join(\"-\");\r\n    const extension = FILE_TYPE_MAP[file.mimetype];\r\n    cb(null, `${fileName}-${Date.now()}.${extension}`);\r\n  },\r\n});\r\n\r\nconst uploadOptions = multer({ storage: storage });\r\n\r\n//GET products\r\nrouter.get(\"/\", productController.getProducts);\r\n\r\n//products on sale - limit\r\nrouter.get(\"/sale/:limit\", productController.getProductOnSale);\r\n\r\n//count product\r\nrouter.post(\"/count\", productController.countProduct);\r\n\r\n//fetch single product\r\nrouter.get(\"/:id\", productController.getProduct);\r\n\r\n//post products\r\nrouter.post(\"/\", uploadOptions.single(\"image\"), productController.postProduct);\r\n\r\n//post products\r\nrouter.post(\r\n  \"/upload/imageGallery\",\r\n  uploadOptions.array(\"images\", 10),\r\n  productController.uploadImageGallery\r\n);\r\n\r\n//update product\r\nrouter.post(\"/update/:id\", productController.updateProduct);\r\n\r\n//delete product\r\nrouter.post(\"/delete/:id\", productController.deleteProduct);\r\n\r\nmodule.exports = router;\r\n"],"mappings":"AAAA,IAAMA,OAAO,GAAGC,OAAO,CAAC,SAAD,CAAvB;;AAEA,IAAMC,MAAM,GAAGF,OAAO,CAACG,MAAR,EAAf;;AAEA,IAAMC,iBAAiB,GAAGH,OAAO,0BAAjC;;AAEA,IAAMI,MAAM,GAAGJ,OAAO,CAAC,QAAD,CAAtB;;AAEA,IAAMK,aAAa,GAAG;EACpB,aAAa,KADO;EAEpB,cAAc,MAFM;EAGpB,aAAa;AAHO,CAAtB;AAMA,IAAMC,OAAO,GAAGF,MAAM,CAACG,WAAP,CAAmB;EACjCC,WAAW,EAAE,qBAAUC,GAAV,EAAeC,IAAf,EAAqBC,EAArB,EAAyB;IACpC,IAAMC,OAAO,GAAGP,aAAa,CAACK,IAAI,CAACG,QAAN,CAA7B;IACA,IAAIC,WAAW,GAAG,IAAIC,KAAJ,CAAU,oBAAV,CAAlB;;IAEA,IAAIH,OAAJ,EAAa;MACXE,WAAW,GAAG,IAAd;IACD;;IACDH,EAAE,CAACG,WAAD,EAAc,gBAAd,CAAF;EACD,CATgC;EAUjCE,QAAQ,EAAE,kBAAUP,GAAV,EAAeC,IAAf,EAAqBC,EAArB,EAAyB;IACjC,IAAMM,QAAQ,GAAGP,IAAI,CAACQ,YAAL,CAAkBC,KAAlB,CAAwB,GAAxB,EAA6BC,IAA7B,CAAkC,GAAlC,CAAjB;IACA,IAAMC,SAAS,GAAGhB,aAAa,CAACK,IAAI,CAACG,QAAN,CAA/B;IACAF,EAAE,CAAC,IAAD,EAAUM,QAAV,SAAsBK,IAAI,CAACC,GAAL,EAAtB,SAAoCF,SAApC,CAAF;EACD;AAdgC,CAAnB,CAAhB;AAiBA,IAAMG,aAAa,GAAGpB,MAAM,CAAC;EAAEE,OAAO,EAAEA;AAAX,CAAD,CAA5B;AAGAL,MAAM,CAACwB,GAAP,CAAW,GAAX,EAAgBtB,iBAAiB,CAACuB,WAAlC;AAGAzB,MAAM,CAACwB,GAAP,CAAW,cAAX,EAA2BtB,iBAAiB,CAACwB,gBAA7C;AAGA1B,MAAM,CAAC2B,IAAP,CAAY,QAAZ,EAAsBzB,iBAAiB,CAAC0B,YAAxC;AAGA5B,MAAM,CAACwB,GAAP,CAAW,MAAX,EAAmBtB,iBAAiB,CAAC2B,UAArC;AAGA7B,MAAM,CAAC2B,IAAP,CAAY,GAAZ,EAAiBJ,aAAa,CAACO,MAAd,CAAqB,OAArB,CAAjB,EAAgD5B,iBAAiB,CAAC6B,WAAlE;AAGA/B,MAAM,CAAC2B,IAAP,CACE,sBADF,EAEEJ,aAAa,CAACS,KAAd,CAAoB,QAApB,EAA8B,EAA9B,CAFF,EAGE9B,iBAAiB,CAAC+B,kBAHpB;AAOAjC,MAAM,CAAC2B,IAAP,CAAY,aAAZ,EAA2BzB,iBAAiB,CAACgC,aAA7C;AAGAlC,MAAM,CAAC2B,IAAP,CAAY,aAAZ,EAA2BzB,iBAAiB,CAACiC,aAA7C;AAEAC,MAAM,CAACC,OAAP,GAAiBrC,MAAjB"},"metadata":{},"sourceType":"script"}