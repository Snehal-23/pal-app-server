{"ast":null,"code":"var _regeneratorRuntime = require(\"@babel/runtime/regenerator\");\n\nvar expressJwt = require(\"express-jwt\");\n\nvar _require = require(\"express-jwt\"),\n    done = _require.done;\n\nfunction authJwt() {\n  return expressJwt.expressjwt({\n    secret: process.env.SECRET,\n    algorithms: [\"HS256\"],\n    isRevoked: isRevoked,\n    getToken: getTokenFromHeader\n  }).unless({\n    path: [{\n      url: /\\/public\\/uploads(.*)/,\n      methods: [\"GET\", \"OPTIONS\"]\n    }, {\n      url: /\\/api\\/v1\\/products(.*)/,\n      methods: [\"GET\", \"OPTIONS\"]\n    }, {\n      url: /\\/api\\/v1\\/categories(.*)/,\n      methods: [\"GET\", \"OPTIONS\"]\n    }, \"/api/v1/users/login\", \"/api/v1/users/register\"]\n  });\n}\n\nfunction getTokenFromHeader(req) {\n  if (req.headers.authorization && req.headers.authorization.split(\" \")[0] === \"Bearer\") {\n    return req.headers.authorization.split(\" \")[1];\n  }\n\n  return null;\n}\n\nfunction isRevoked(req, payload, done) {\n  return _regeneratorRuntime.async(function isRevoked$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          if (payload.payload.isAdmin) {\n            _context.next = 2;\n            break;\n          }\n\n          return _context.abrupt(\"return\", done(null, true));\n\n        case 2:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, null, null, null, Promise);\n}\n\nmodule.exports = authJwt;","map":{"version":3,"names":["expressJwt","require","done","authJwt","expressjwt","secret","process","env","SECRET","algorithms","isRevoked","getToken","getTokenFromHeader","unless","path","url","methods","req","headers","authorization","split","payload","isAdmin","module","exports"],"sources":["C:/Users/snehal/eduvanz/pal/helpers/authMiddleware.js"],"sourcesContent":["const expressJwt = require(\"express-jwt\");\r\nconst { done } = require(\"express-jwt\");\r\n\r\nfunction authJwt() {\r\n  return expressJwt\r\n    .expressjwt({\r\n      secret: process.env.SECRET,\r\n      algorithms: [\"HS256\"],\r\n      isRevoked: isRevoked,\r\n      getToken: getTokenFromHeader,\r\n    })\r\n    .unless({\r\n      path: [\r\n        { url: /\\/public\\/uploads(.*)/, methods: [\"GET\", \"OPTIONS\"] },\r\n        { url: /\\/api\\/v1\\/products(.*)/, methods: [\"GET\", \"OPTIONS\"] },\r\n        { url: /\\/api\\/v1\\/categories(.*)/, methods: [\"GET\", \"OPTIONS\"] },\r\n        \"/api/v1/users/login\",\r\n        \"/api/v1/users/register\",\r\n      ],\r\n    });\r\n}\r\n\r\nfunction getTokenFromHeader(req) {\r\n  // console.log(req.headers);\r\n  if (\r\n    req.headers.authorization &&\r\n    req.headers.authorization.split(\" \")[0] === \"Bearer\"\r\n  ) {\r\n    return req.headers.authorization.split(\" \")[1];\r\n  }\r\n  return null;\r\n}\r\n\r\nasync function isRevoked(req, payload, done) {\r\n  if (!payload.payload.isAdmin) {\r\n    return done(null, true);\r\n  }\r\n  // done(null, false);\r\n}\r\n\r\nmodule.exports = authJwt;\r\n"],"mappings":";;AAAA,IAAMA,UAAU,GAAGC,OAAO,CAAC,aAAD,CAA1B;;AACA,eAAiBA,OAAO,CAAC,aAAD,CAAxB;AAAA,IAAQC,IAAR,YAAQA,IAAR;;AAEA,SAASC,OAAT,GAAmB;EACjB,OAAOH,UAAU,CACdI,UADI,CACO;IACVC,MAAM,EAAEC,OAAO,CAACC,GAAR,CAAYC,MADV;IAEVC,UAAU,EAAE,CAAC,OAAD,CAFF;IAGVC,SAAS,EAAEA,SAHD;IAIVC,QAAQ,EAAEC;EAJA,CADP,EAOJC,MAPI,CAOG;IACNC,IAAI,EAAE,CACJ;MAAEC,GAAG,EAAE,uBAAP;MAAgCC,OAAO,EAAE,CAAC,KAAD,EAAQ,SAAR;IAAzC,CADI,EAEJ;MAAED,GAAG,EAAE,yBAAP;MAAkCC,OAAO,EAAE,CAAC,KAAD,EAAQ,SAAR;IAA3C,CAFI,EAGJ;MAAED,GAAG,EAAE,2BAAP;MAAoCC,OAAO,EAAE,CAAC,KAAD,EAAQ,SAAR;IAA7C,CAHI,EAIJ,qBAJI,EAKJ,wBALI;EADA,CAPH,CAAP;AAgBD;;AAED,SAASJ,kBAAT,CAA4BK,GAA5B,EAAiC;EAE/B,IACEA,GAAG,CAACC,OAAJ,CAAYC,aAAZ,IACAF,GAAG,CAACC,OAAJ,CAAYC,aAAZ,CAA0BC,KAA1B,CAAgC,GAAhC,EAAqC,CAArC,MAA4C,QAF9C,EAGE;IACA,OAAOH,GAAG,CAACC,OAAJ,CAAYC,aAAZ,CAA0BC,KAA1B,CAAgC,GAAhC,EAAqC,CAArC,CAAP;EACD;;EACD,OAAO,IAAP;AACD;;AAED,SAAeV,SAAf,CAAyBO,GAAzB,EAA8BI,OAA9B,EAAuCnB,IAAvC;EAAA;IAAA;MAAA;QAAA;UAAA,IACOmB,OAAO,CAACA,OAAR,CAAgBC,OADvB;YAAA;YAAA;UAAA;;UAAA,iCAEWpB,IAAI,CAAC,IAAD,EAAO,IAAP,CAFf;;QAAA;QAAA;UAAA;MAAA;IAAA;EAAA;AAAA;;AAOAqB,MAAM,CAACC,OAAP,GAAiBrB,OAAjB"},"metadata":{},"sourceType":"script"}